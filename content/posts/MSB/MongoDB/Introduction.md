---
title: MongoDB 简介
date: '2021-04-15 21:03:00'
tags:
- MSB
- Database
- MongoDB
- Java
---
# MongoDB 简介

数据库排名网站：[db-engines](https://db-engines.com/en/ranking)

## MongoDB 应用场景

- 游戏场景：存储游戏用户信息，用户装备，积分等直接以内嵌文档的形式存储，方便查询，更新
- 物流场景：存储订单信息，订单状态在运送过程中会不断更新，一次查询就可以将订单所有的变更读取出来
- 社交场景：存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的人，地点等功能
- 物联网场景：存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行对纬度的分析
- 视频直播：存储用户信息，礼物信息等

**价值低的数据。对事物要求不高，比如银行转账业务，就不适合**，在 4.0 之后支持事物，所以可以尝试将重要数据也用 MongoDB 进行存储，因为其比 MySQL 等性能高，扩展性好

## MongoDB 优势

JSON 数据结构：节省了数据库层结构的设计和 ORM 层编码的开发

1. 对于程序员来说，可以花更少的时间在业务设计上，专注于业务编程
2. DBA：解决高可用高性能以及横向扩展的痛点
3. 架构师或产品经理：MongoDB 灵活的数据结构可以快速响应业务需求的变化

## 京东商城架构

商品订单基本信息：关系型数据库

描述性信息，详情，用户评论等文字多，IO 读写性能差的：用 MongoDB

商品图片：对象存储 CDN

商品搜索，关键词：ES

热卖，促销，活动，秒杀：内存数据库 redis

订单，运单传递：MQ

**难点**：数据多样，数据结构变化

**解决方案**

1. 大规模集群
2. 业务模型拆分
3. 多数据节点支撑，混合技术实践

4.0 之后开始支持事物

## MongoDB 与 RDBMS 对比

|              | MongoDB                                         | RDBMS                  |
| ------------ | ----------------------------------------------- | ---------------------- |
| 数据类型     | 文档类型                                        | 关系模型               |
| 数据库类型   | OLTP                                            | OLTP                   |
| CRUD 操作     | MQL/SQL                                         | SQL                    |
| 高可用       | 复制集                                          | 集群模式               |
| 横向扩展能力 | 通过原生分片完善支持                            | 数据分区或者应用嵌入式 |
| 索引支持     | B-树，全文索引，地理位置索引，多键索引，TTL 索引 | B 树                    |
| 开发难度     | 容易                                            | 困难                   |
| 数据容量     | 没有理论上限                                    | 千万，亿               |
| 扩展方式     | 垂直扩展 + 水平扩展                             | 垂直扩展               |

## MongoDB 与 SQL 的对比

| SQL 术语/概念 | MongoDB 术语/概念 | 说明                           |
| ------------ | ---------------- | ------------------------------ |
| database     | database         | 数据库                         |
| table        | collection       | 数据库表/集合                  |
| row          | document         | 数据记录行/文档                |
| column       | field            | 数据字段/域                    |
| index        | index            | 索引                           |
| table joins  |                  | 表连接/MongoDB 不支持           |
|              | 嵌入文档         | 通过嵌入文档代替多表连接       |
| primary key  | primary key      | 主键，MongoDB 自动将_id 作为主键 |

## MongoDB 的数据模型

MongoDB 的最小存储单元是文档（document）对象。文档对象对应于关系型数据库的行。数据在 MongoDB 中以 BSON（Binary-JSON）的形式存储在磁盘上。

BSON 是一种类 json 的一种二进制形式的存储格式，支持内嵌的文档对象和数组对象，但是 BSON 有 JSON 没有的一些数据类型，例如 Date 和 BinData 类型

BSON 具有轻量性，可遍历性，高效性的三个特点，可以有效的描述结构化和非结构化的数据。这种格式的优点是灵活性高，缺点是空间利用率不是很理想。

MongoDB 中常用的几种数据类型

| 数据类型           | 描述                                                         |
| ------------------ | ------------------------------------------------------------ |
| String             | 字符串。存储数据常用的数据类型。在 MongoDB 中，UTF-8 编码的字符串才是合法的 |
| Integer            | 整型数值。用于存储数值。根据你所采用的服务器，可分为 32 位或 64 位 |
| Boolean            | 布尔值。用于存储布尔值（真/假）                                |
| Double             | 双精度浮点值。用于存储浮点值                                 |
| Min/Max keys       | 将一个值与 BSON（二进制的 JSON）元素的最低值和最高值相对比       |
| Array              | 用于将数组或列表或多个值存储为一个键                         |
| Timestamp          | 时间戳。记录文档修改或添加的具体时间                         |
| Object             | 用于内嵌文档                                                 |
| Null               | 用于创建空值                                                 |
| Symbol             | 符号。该数据类型基本上等同于字符串类型，但不同的是，它一般用于采用特殊符号类型的语言 |
| Date               | 日期时间。用 UNIX 时间格式来存储当前日期或时间。你可以指定自己的日期时间：创建 Date 对象，传入年月日信息 |
| Object ID          | 对象 ID。用于存储文档的 ID                                     |
| Binary Data        | 二进制数据。用于存储二进制数据                               |
| Code               | 代码类型。用于在文档中存储 JavaScript 代码                     |
| Regular expression | 正则表达式类型。用于存储正则表达式                           |

- 简单直观：MongoDB 按照类似 JSON 字符串进行存储，一个对象就是一个 JSON 串

- 结构灵活：可动态增减字段
- 多形性：同一个集合中可以包含不同的字段
- 动态性：线上修改数据格式，修改时应用与数据均无需下线
- 数据治理：支持使用 JSON Schema 来规范数据模式。在保证模式灵活动态的前提下，提供数据治理能力
- 快速开发：做更多的时，写更少的代码。MySQL:MonogoDB≈100:10

## MongoDB 的特点

1. 高性能

   MongoDB 提供高性能的数据持久性。

   - 对嵌入式数据模型的支持减少了数据库系统上的 I/O 活动
   - 索引支持更快的查询，并且可以包含来自嵌入式文档和数组的键
   - mmapv1，wiredtiger，mongorocks，in-memory 等多引擎支持满足各种场景需求
   - Gridfs 解决文件存储的需求

2. 高可用

   MongoDB 的复制工具称为复制集（replica set），它可以提供自动故障转移和数据冗余

   - 支持 2-50 个成员，一般建议 3 个左右
   - 自动恢复
   - 多中心容灾能力

3. 高扩展性

   MongoDB 提供了水平可扩展属性作为其核心功能的一部分

   - 分片将数据分布在一组集群的机器上。
   - 从 3.4 开始，MongoDB 支持基于分片创建数据区域。在一个平衡的集群中，MongoDB 将一个区域所覆盖的读写只定向到该区域的那些片
   - 轻松支持 TB-PB 数量级别

## 技术选型依据

1. 应用不需要事物及 join 支持
2. 新应用，需求会变，数据模型无法确定，想快速迭代开发
3. 应用需要 2000-3000 以上的读写 QPS（更高也可以）
4. 应用需要 TB 甚至 PB 级别的数据存储
5. 应用发展迅速，需要能快速水平扩展
6. 应用要求存储的数据不丢失
7. 应用需要 99.999% 高可用
8. 用用需要大量的地理位置查询，文本查询

## 技能扩展

1. 如何计算服务器数量

2. 如何计算数据库连接数，1000QPS 需要多少连接数
