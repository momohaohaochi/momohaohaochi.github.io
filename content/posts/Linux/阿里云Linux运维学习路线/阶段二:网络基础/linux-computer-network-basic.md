---
title: 计算机网络基础
date: '2020-06-08 22:42:18'
tags:
- Linux
---

# 计算机网络基础

## 计算机网络概述

### 计算机网络概念

**计算机网络 :** 是指自主计算机的互连集合
- 自主计算机: 指分布在不同地理位置的多台独立的主机
- 互连: 指使用通信介质和网络设备将计算机互相连接起来, 遵循共同的网络协议, 实现通信.

**计算机网络是网络硬件和网络协议的统一体**

### 计算机网络组成结构

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175058.png)

- 通讯终端(主机或服务器等)
- 通信介质(网线等)
- 交换设备(路由器和交换机等)
- ISP: Internet Service Provider, 互联网服务提供商

使用通信介质将通讯设备和交换设备连接起来, 达到互连的效果

### 网络交换技术

#### 电路交换

**是面向连接的**

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175131.png)

是目前电话通讯中使用的核心交换技术

**示例 :**

- A和B通话经过4个交换机
- 通话在A到B的已建立的连接上进行

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175218.png)


**特点 :**
- 面向连接的特性
- 通信资源的独占性

不适合计算机网络通信, 因为计算机网络通讯具有突发性和灵活性的特点

#### 报文交换

基于存储转发原理

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607180024.png)

发送方将发送的报文发送给报文交换机, 报文交换机收到报文后会暂时存储下来, 然后根据报文中的目的地地址信息转发给下一个报文交换机, 最终发送接收方.

**特点 :**

- 报文交换不需要事先建立连接, 可以直接发送数据, 比较灵活
- 每个报文分段占用线路

**缺点 :**

- 时延要比电路交换大
- 要完整地接收传来的整个报文, 因此要求交换机有较大缓冲区

#### 分组交换

也使用存储转发技术, 把较长的报文划分成较短的"分组", 以"分组"为数据传输单元.

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175401.png)


**示例 :**

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175405.png)

计算机A将报文分组后(A1, A2, A3), 通过分组交换机(R1, R2, R3, R4)发送给计算机E.

**特点 :**
- 分组分段地占用通信链路, 通信资源利用率高
- 每个分组独立传输, 灵活性好, 网络适应能力强

**分组交换技术适合计算机网络**

#### 三种交换技术的比较

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175408.png)

- 电路交换: 需要提前建立连接, 然后把整个数据包进行传输
- 报文交换: 使用存储转发技术, 不需要提前建立连接, 将整个报文进行传输
- 分组交换: 使用存储转发技术, 将整个报文分组后进行传输

#### 实现分组交换的两种方式

**数据报方式 :**

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175410.png)

每个数据的分组都有独立的信息, 所以A1, A2可以通过R1->R2链路来传输, A3可以通过R1->R3->R2链路来传输; 发送方A不需要提前和接收方E建立连接.

**虚电路方式 :**

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175413.png)

A与E通讯时, 需要事先呼叫E, 建立一个通讯的链路(虚电路), 每个分组都包含一个虚电路号, 通过预留的链路进行传输.

### 网络拓扑结构

#### 星型拓扑

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175414.png)

- 由一个中心节点和一些外围节点组成
- 缺点: 中心节点如果故障, 则整个网络无法正常工作


#### 环型拓扑

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175415.png)

- 节点分布在一个闭合环形线路上, 数据沿一个方哪个向绕环逐点传递
- 缺点: 可靠性差, 只要一个节点故障, 就会影响整个网络的运行

#### 总线型拓扑

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175418.png)

- 一条公共线路作为传输总线, 每个节点连接到公共总线上
- 缺点: 存在总线争用问题, 节点增多时网络效率低

#### 树型拓扑

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175419.png)

- 形状像一棵倒置的树, 节点按层次进行连接
- 缺点: 网络可靠性差, 一旦根节点故障, 则整个网络瘫痪


#### 网状型拓扑

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175428.png)

- 每两个节点之间都有一条线路相连, 应用于广域网
- 缺点: 控制复杂

### 小结

1. 计算机网络概念
2. 网络交换技术: 电路交换, 报文交换, 分组交换
3. 网络拓扑结构: 星型, 环型, 总线型, 树形, 网状型

## 数据通信技术基础

### 信息, 数据, 信号

- **信息**发送前要编码成**数据**, 数据要用**信号**表示才能发送到对方.
- 对方从**信号**中还原出**数据**, 进而得到信息.

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175432.png)

### 信号

- 模拟信号: 是连续的, 取遍某个区间内的所有值.
- 数字信号: 是离散的, 只包含几个值, 如0, 1.

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175434.png)

### 信号编码方式: 数据->信号

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175437.png)

#### 数据->模拟信号

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175439.png)

需要传输的数据为```101101```, 为了使用这些数据能够适应信道的传输, 可通过幅移键控或频移键控或相移键控三种方法把它转换成可以在信道中传输的模拟信号.

#### 数据->数字信号

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175442.png)

需要传输的数据为```10001101```, 为了使用这些数据能够适应信道的传输, 可通过不归零编码或曼彻斯特编码或差分曼彻斯特编码三种方法把数据转换成可以在信道中传输的数字信号.

不归零编码 :
- 高电压代表数据1, 低电压代表数字0

曼彻斯特编码 :
- 在每一个传输周期之间都有信号的跳变, 由低电位调变为高电位代表1, 由高电位跳变为低电位代表0

差分曼彻斯特编码 :

- 在每一个传输周期之间的前半个传输码源如果和后半个传输码源一致, 代表1, 否则代表0.

### 数据传输方式分类

#### 分类方式一: 并行传输和串行传输

- 并行传输: 是指在两点之间的适当数量的并行路径上, 一组信号元的同时传输.
- 串行传输: 是指信号元在两点之间的单一路径上的顺序传输.

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175444.png)

#### 分类方式二: 单工, 半双工, 全双工

- 单工传输: 信息只能由一方A传到另一方B
- 半双工传输: 信息既可由A传到B, 又能由B传到A, 但同时只能有一个方向上的传输存在
- 全双工传输: 线路上同时存在A到B和B到A的双向信号传输

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175445.png)

### 小结

1. 信号: 模拟信号, 数字信号
2. 信号编码方式:
    - 模拟信号: ASK, FSK, PSK
    - 数字信号: 非归零码, 曼彻斯特编码, 差分曼彻斯特编码
3. 数据传输方式
    - 并行传输, 串行传输
    - 单工, 半双工, 全双工

## 双绞线的制作

### 传输介质

分为**有线介质**和**无线介质**两种

**有线介质 :**

- 双绞线: 是由两条相互绝缘的导线按照一定的密度相互缠绕在一起而制作成的一种通用配线. 局域网中所使用的双绞线分为两类: 屏蔽双绞线(STP)与非屏蔽双绞线(UTP)

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175447.png)

- 同轴电缆

- 光纤

**无线介质 :**

- 无线介质


#### 双绞线和RJ-45接口

**RJ-45接口 :**是一种能沿固定方向插入并自动防止脱落的塑料街头

每条双绞线的两端, 按照一定的线序标准(T568A标准或T568B标准), 连接好水晶头后, 便可连接网卡, 集线器, 交换机等设备上的RJ-45接口.

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175448.png)

#### T568A和T568B标准

是RJ-45接头的打线标准

- 正线: T568B--T568B, 平时使用的网线
- 反线: T568B--T568A, 用来连接相同类的设备

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175450.png)

- T568B线序: 白橙 橙 白绿 蓝 白蓝 绿 白棕 棕
- T568A线序: 是将T568B的1,3进行对调, 2,6进行对调.

**网线制作 :**

- 使用网线夹取出最外层绝缘体剥离2cm左右
- 按线序将内部的线排列整齐, 让相邻网线间没有空隙
- 使用网线钳将线掐断, 掐齐;
- 水晶头卡簧向下, 将网线插入到水晶头, 尽量往里, 确保线序没有被改变, 外部绝缘皮也要进入一部分
- 使用网线钳将水晶头加紧.
- 使用网线测试仪进行测试

## 网络体系结构

- 相互连通的两个计算机系统必须高度协调工作才行, 而这种"协调"是相当复杂的

- "**分层**"可将庞大而复杂的问题, 转化为若干较小的局部问题, 而这些较小的局部问题就比较易于研究和处理

- 计算机网络的**体系结构**是计算机网络的各层及其协议的集合

### OSI参考模型

**OSI参考模型:** 理论模型

**TCP/IP参考模型:** 因特网标准, OSI参考模型的一种实现

- OSI参考模型定义网络通信的层次结构, 层次之间的相互关系与各层提供的服务
- 只要遵循OSI标准, 一个系统就可以和位于世界上任何地方的, 也遵循这一标准的其他任何系统进行通信

#### OSI参考模型-分层原则

- 网中各节点都具有**相同的层次**
- 不同节点的同等层具有**相同的功能**
- 同一节点内相邻层之间通过**接口**通信
- 每层可以使用下层提供的**服务**, 冰箱上层提供服务
- 不同节点的对等层通过**协议**来实现对等层次之间的通信

#### OSI参考模型-层次结构

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175451.png)

1. 物理层(physical layer): 利用传输介质实现比特序列的传输
2. 数据链路层(data link layer): 采用差错控制与流量控制方法, 使得有差错的物理线路变成无差错的数据链路
3. 网络层(network layer): 实现路由选择, 分组转发与拥阻控制等功能, 为"分组"传输选择"最佳"的路由
4. 运输层(transport layer): 向高层用户提供可靠的"端-端"通信服务, 向高层屏蔽下层数据通信的具体细节
5. 会话层(session layer): 维护两个通信计算机之间的进程通信, 管理数据交换
6. 表示层(presentation layer): 处理两个通信的计算机系统的数据表示方式, 完成数据的格式变换, 加密与解密, 压缩与恢复
7. 应用层(application layer): 为应用软件提供多种网络服务, 例如万维网, 文件传输, 电子邮件与其他服务等


**执行流程**

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175452.png)

主机A与主机B要实现通信, 两台机器都遵循OSI参考模型, 首先, 数据由主机A的应用进程产生, 然后依次向下层处理, 每层都在数据前添加一个具有该层特点的首部, 最终数据传输到物理层后, 将数据转换成可以在网络中传输的信号(比特序列), 通过传输介质将这些比特序列传输到接收方主机B的物理层, 然后依次向高层处理, 将具有每层特点的首部去掉, 最终获取到真实的数据.

由高层至低层添加首部的过程称为封装, 由低层至高层去除首部的过程称为解封装.

### 小结
1. 网络体系结构
    - OSI
    - TCP/IP
2. OSI参考模型
    - 应用层, 表示层, 会话层, 运输层
    - 网络层, 数据链路层, 物理层


### OSI参考模型与TCP/IP参考模型比较

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175453.png)

TCP/IP参考模型是基于Internet通讯的需求, 在此基础上实现了一些具体的协议, 在此基础上完善基础的通讯标准

- 网络接口层: 负责通过网络发送和接收IP数据报
- 互联网层: 使用IP协议提供"尽力而为(best effort)"网络分组传输服务. 将运输层报文段封装成IP数据报, 选择适当的发送路径, 并将数据报发送到下一个结点.
- 运输层: 负责在会话的进程之间建立和维护"端-端"的连接. 定义了两种不同的协议: 传输控制协议(TCP)和用户数据报协议(UDP).
- 应用层: 为应用软件提供多种网络服务, 通过具体的网络协议(例: HTTP, FTP等)进行正常的网络传输.


### TCP/IP技术栈

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175455.png)


### 总结
1. 两种参考模型的比较
2. TCP/IP参考模型
- 应用层, 运输层, 互联网层, 网络接口层
3. TCP/IP协议栈

## 局域网技术

### 局域网概念

#### 根据网络规模分类

**广域网**

覆盖范围大, 传输距离远, 传输率低, 误码率高

**城域网**

覆盖范围介于局域网和广域网之间, 几公里到几十公里

**局域网**

- 局部区域范围内的计算机网络
- 范围: 几米至及公里, 一个或相邻的建筑物内
- 特点: 覆盖范围小, 传输速率高, 误码率低
- 应用: 多用于单位内部网络建设

#### 局域网常用拓扑结构

局域网中常见的拓扑结构有以下三种 :

- 总线型(使用最多)
- 星型
- 环型

#### 局域网体系结构

局域网是一种通信网络, 只涉及OSI模型中的数据链路层和物理层, 不涉及高层内容

IEEE的802委员会将局域网分为两个子层 :
- MAC子层: 与计入到传输媒体有关的内容都放在MAC子层. 主要用来解决多个节点如何使用共享介质的问题
- LLC子层: 与媒体接入无关的部分都集中在LLC. 其主要功能是数据链路的建立和释放, LLC帧的封装和拆卸, 差错控制, 提供与高层的接口等

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175459.png)

#### 物理地址

在局域网中, 硬件地址又称为物理地址, 或MAC地址, 是在数据链路层使用的地址. MAC地址共48比特, 6字节. 前三个字节代表的是生产厂商编号, 后三个字节代表的是网卡的编号

MAC地址通常表示为12个16进制数, 每两个16进制数之间用冒号隔开, 08:00:20:0A:8C:6D就是一个MAC地址

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175500.png)

#### 物理地址的使用

数据链路层中数据是以数据帧(frame)为单位进行传输的. 封装成帧就是在一段数据的前后分别添加首部和尾部, 然后就构成了一个帧, 确定了帧的界限.

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175501.png)

数据帧首部中的源地址和目的地址就是用MAC地址来表示的

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175502.png)

发送数据帧时, 帧首部写入目的主机的MAC地址

收到数据帧后, 首先检查帧首部的目的MAC地址, 如果是发给自己的, 就接收数据帧, 否则就丢弃

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175503.png)

#### CSMA/CD协议

目前局域网采用的最通用的通信协议标准是以太网(Ethernet)技术

最初的以太网是一个总线型的网络, 任何一个主机发出信号, 都能被所有主机收到

**以太网需要解决如下问题 :**

- 寻址问题: 如何在广播式的网络完成一对一通信(解决方式为: MAC地址)
- 冲突问题: 两台主机同时使用网络会发生冲突(解决方式为: CSMA/CD协议)

**以太网使用载波监听多路访问/冲突检测协议(CSMA/CD)来解决总线使用权的问题, 处理网络中产生的冲突问题**

- 多路访问: 网络中的每个节点都能访问总线, 通过总线发送数据
- 载波侦听: 在发送数据前, 节点要先"听"一下总线上是否有数据信号. 如果检测到有数据信号, 节点便等待直到总线空闲. 如果"听"到总线没有数据信号, 那么节点就将数据帧发送处去.
- 冲突检测: 在发送数据帧的同时, 还需要继续监听总线, 检测是否发生冲突. 如果检测到了冲突, 就马上停止数据发送. 等待一个随机的时间后, 再次重发.

**为什么需要"冲突检测"**

当某个站监听到总线是空闲时, 也可能总线并非真正的空闲

A向B发出的信息, 要经过一定的时间后才能传送到B

B若在A发送的信息到达B之前发送自己的帧(因为这时B的载波监听检测不到A所发送的消息), 则必然要在某个时间和A发送的帧发生碰撞

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175505.png)


![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175506.png)


**冲突带来的问题**

碰撞的结果是两个帧都变得无用(冲突使信号相互叠加, 使得原来的信号被破坏), 而且这些无用的数据浪费了网络资源

节点在检测到冲突的时候, 就马上停止数据发送. 但是之前已经发出的数据还是会被接收方接收到, 而且是不完整的数据. 所以接收方需要知道是否曾经发生冲突, 收到的数据是否完整

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175507.png)

**争用期(解决不完整数据问题)**

从开始发送数据, 到检测到冲突, 这段时间是不确定的, 它的最大值称为争用期. 如果在争用期内没有检测到冲突, 以后也不会有冲突产生了.

在以太网中, 争用期=2倍总线长度/信号的传播速度

**最短帧长(解决不完整数据问题)**

以太网取51.2μs为争用期的长度. 对于10Mb/s以太网, 在争用期内可以发送512bit, 即64字节. 以太网在发送数据时, 若前64字节没有发生冲突, 则后续的数据就不会发生冲突. (10Mb/s*51.2μs=512bit)

以太网规定了最短有效帧长为64字节, 凡长度小于64字节的帧都是由于冲突而异常中止的无效帧.

### 小结

1. 局域网概念
- 拓扑结构, 体系结构
2. 物理地址
- MAC地址
- 数据帧
3. CSMA/CD协议
- 载波监听, 多路访问, 冲突检测
- 争用期, 最短帧长

## 广域网技术

相距较远的局域网通过路由器与广域网相连组成了一个覆盖范围很广的互联网

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175508.png)

**广域网实现的通信**

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175509.png)


- 租用线路: 是电信公司根据客户的需求建立的专用线路, 例如PPP协议
- 电路交换: 电信运营商的电话线, 需要维护一个物理线路
- 分组交换: 不依赖于永久性的依赖链路, 


### 广域网PPP协议

点对点协议(Point-to-Point Protocol), 是因特网上广泛使用的数据链路层协议, 用于点对点的链路

PPP设计目的主要是用来通过拨号或专线放哪个是建立点对点连接发送数据. 用户使用拨号电话线接入因特网时, 一般都是使用PPP协议(PPPOE)

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175510.png)


**PPP协议有三个组成部分**

1. 一个将IP数据报封装到串行链路的方法
2. 链路控制协议LCP(Link Control Protocol)
3. 网络控制协议NCP(Network Control Protocol)

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175511.png)

**PPP协议的数据封装**

- 标志字段: 表示帧的开始和结束, 固定使用01111110
- 地址字段: 由于PPP协议用于点对点通信, 不存在寻址的问题, 固定使用11111111
- 控制字段: PPP协议不提供数据传输的可靠性, 同时也没有流量控制和差错功能, 固定使用11000000
- 协议字段: PPP帧内可以封装多个协议的数据包, 当封装某个协议的数据包时, 就填写这个协议的编号
- FCS: 帧校验字段, PPP采用CRC校验

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175512.png)

#### 链路控制协议LCP

数据链路的建立, 配置, 维护和终止都是有链路控制协议(LCP)来完成的, LCP包封装在PPP帧的数据字段中

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175513.png)


##### 认证协议

**口令认证协议(PAP) :** 非常简单, 用户向系统发送用户名和口令, 系统验证用户名和口令, 如果正确就接受连接, 否则就拒绝连接. 认证是通过两次握手实现的.

**挑战握手协议(CHAP) :** 对PAP协议做了改进, 不直接发送用户名和密码. 取代密码的是Hash(哈希值)
1. 首先向用户发送一个CHAP包, 数据部分包含一个随机数
2. 用户收到后, 使用事先定义好的函数作用于随机数和自己的口令, 生成一个值, 将这个值和用户名放入CHAP包发给系统
3. 系统收到后, 根据其中的用户名查到对应的口令, 用同一个函数对查到的口令和查问值进行运算, 如果计算结果与用户的值相同, 说明是合法用户, 并且口令正确.

### 网络控制协议NCP

PPP使用网络控制协议(NCP)来建立两端网络层的连接, 协商网络层的选项和传递网络层数据. NCP不是一个协议, 而是一组协议, 包括IPCP, IP, IPX等.

互联网协议控制协议(IPCP)主要用来协商网络层选项, 设置用户的IP地址. 报文在PPP帧中封装.

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175514.png)

### PPP协议工作过程

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175515.png)


1. 用户通过专用的呼叫设备与路由器对端建立物理链路的连接
2. 使用LCP协议与对端建立数据链路的连接
3. 通过PAP或CHAP协议进行认证
4. 通过IPCP协议协议协商网络层参数和IP地址等信息
5. 正式传输网络层的数据(可能使用IP协议)
6. 数据传输结束后, 通过IPCP协议终止网络层的活动
7. 通过LCP协议终止数据链路层的连接

### 总结

1. 广域网概念
- 广域网概念, 广域网协议
2. 广域网PPP协议
- 数据帧封装
- 链路控制协议LCP
- 认证协议
- 网络控制协议NCP
- 工作过程

## 交换机相关知识

如下图所示是具有24个RJ-45端口的交换机, 它一般用于小型局域网

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175517.png)

交换机连接计算机示意图如下图所示

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607235654.png)


例子: 一个机房需要连接50台计算机, 如果使用具有24个端口的交换机, 则需要3台交换机连接计算机

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175519.png)

### 交换机工作原理

交换机是工作在OSI数据链路层的设备. 它的主要功能是MAC地址学习, 通信过滤(数据帧单点转发), 避免回路等

在每个交换机内部都维护有一张表(MAC地址表), 这个表记录了交换机上每个端口所连接主机的MAC地址信息

交换机收到一个数据帧后, 能够识别出这个帧的结构, 根据帧的目的地址, 将这个帧转发到对应的某个端口上去, 而不是广播到其他所有端口.

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175520.png)

### 交换机MAC地址表

**交换机具有MAC地址学习功能. 交换机就是通过识别数据帧的源MAC地址, 学习到MAC地址和源端口的对应关系, 主要过程如下:**

1. 当第一次使用交换机时, 交换机MAC地址表是空表, 没有任何记录, 此时交换机会将源MAC地址与源端口建立映射, 并将其写入交换机的MAC地址表中
2. 将数据帧(含有目标MAC地址)从所有其他端口转发出去
3. 当接收者收到数据帧并返回信息时, 交换机便记住对应的MAC地址与端口的映射, 并将其对应关系写入到MA地址表中, 以便下次的转发.


**示例 :** 
PC1(MAC地址为M1)想要发送数据帧给PC2(MAC地址为M2), 其MAC地址学习过程如下:

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175521.png)

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175523.png)

1. 交换机收到PC1发来的数据帧, 将其MAC地址和对应交换机端口号记录到MAC地址表中
2. 搜索发现目的MAC不在当前地址表, 所以会将数据帧从所有端口转发出去
3. PC3和PC4发现数据包不是发送给自己的, 就丢弃该数据帧. 而PC2发现这个数据包是发送给自己的, 就将自己的MAC地址发送给PC1
4. 该数据包到达交换机后, 会将PC2的MAC地址和交换机的端口记录到MAC地址表中
5. 以后进行数据发送, 即可根据MAC地址表直接对数据帧进行转发

### 交换机数据交换方式

1. 交换机监测发送到每个交换机端口的数据帧, 通过数据帧中的有关信息(源主机的MAC地址, 目的主机的MAC地址), 在交换机内部建立一张MAC地址与端口映射表
2. 交换机根据收到数据帧中的源MAC地址, 首先查找MAC地址表, 如果找到该映射项(对应的端口号), 则更新映射的生存期; 如果没有找到, 则建立该地址同交换机端口的映射, 并将其写入MAC地址表中
3. 如果数据帧中的目的MAC地址在MAC地址表中找到, 则判断该数据怎属于广播帧还是单播帧: 如果是广播帧, 则向所有端口(除接收该数据帧的端口外)转发该数据帧; 如果是单播帧, 则查找已有MAC地址表, 根据MAC地址表中存在对应的映射, 按照该映射项进行数据转发
4. 如果数据帧中的目的MAC地址不在MAC地址表, 则向所有端口转发. 一旦收到接收者返回的信息, 便记住该MAC地址与端口的映射, 并将数据帧通过该端口转发出去


### 交换机总结

1. 初识交换机设备
2. 交换机工作原理
3. 交换机MAC地址表
4. 交换机数据交换方式

## 路由器相关知识

路由器工作在OSI参考模型的第三层(网络层), 具有网络层功能, 它连接不同的网络, 在网络之间转发IP数据报

路由器具有多个输入端口和多个输出端口. 其任务是转发IP数据报(分组). 将路由器某个输入端口收到的分组, 按照目的地, 从路由器的某个输出端口转发给下一个路由器

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175524.png)


### 路由器的使用

连接两个不同的局域网, 并且使局域网接入广域网

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175525.png)

目前家庭中, 常使用路由器连接多台计算机同时接入Internet

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175526.png)

### 路由器的分类

#### 家用路由器

- 功能比较简单, 价格便宜
- 支持拨号, 内置DHCP服务器(可以为共享上网计算机动态分配地址), 并可进行静态地址分配

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175528.png)

#### 模块化结构的路由器

- 通常中高端路由器采用模块化结构, 底端路由器采用非模块化结构
- 可以在中小型企业网中担当核心路由器

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175530.png)

### 路由器端口

主要分为三类:
- **局域网端口:** 局域网接口主要用于路由器与局域网进行连接. RJ-45接口是最常见的端口, 即双绞线以太网端口
- **广域网端口:** 路由器要实现与广域网的连接. 会用到同步串口(Serial), 这种端口连接网络的两端, 都需要实时同步.

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175531.png)

- **配置端口:** 路由器的配置端口有"Console"和"Aux"端口两种. 
    - "Console"端口常在本地配置路由器连接计算机时使用. 使用Console线的一端连接路由器的Console端口, 另一端连接计算机, 用户可通过计算机运行终端仿真程序, 在本地进行路由器配置
    ![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175532.png)
    - "Aux"端口在路由器远程配置连接时使用
    ![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175533.png)

### 路由器工作原理

路由器的主要功能分为**路由选择**和**分组转发**
- **分组转发**将从端口收到的数据包根据目的地查找转发表从输出端口表送出去
- **路由选择**根据相邻路由器之间通过路由协议实现相邻路由器的相互学习, 生成路由表, 路由选择需要一直维护和更新这张路由表, 转发表就是从路由表转换而来的.

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175535.png)

如果接收的数据包的分组是属于路由消息的, 路由器就会将这个消息, 放到路由选择处理器中, 生成路由表

如果接受到的数据包分组是本身IP协议传递的数据包, 就按照分组转发的转发表中对应的信息, 将数据包转发出去


主机和路由器根据IP数据报的目的IP地址, 通过查找路由表确定下一站

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175537.png)

#### 路由表

路由表中记录了如何达到其他网络的信息

每条路由表项主要由三部分组成: 目的网络, 子网掩码和下一站

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175538.png)

路由表是以目的网络号为目的地, 而不是以目的主机的IP地址为目的地

路由表记录的是到达下一站要如何传输, 而不是传输的全部路径

### 总结

- 初始路由器
- 路由器工作原理
- 路由表

## 配置VLAN

### VLAN基础知识

VLAN: 虚拟局域网(Virtual Local Area Network)
- VLAN是划分出来的逻辑网络, 是二层网络
- VLAN端口不受物理位置的限制: 可将交换机上的物理端口进行任意组合
- VLAN隔离广播域: 不在同一vlan中的端口, 不能互相访问

**示例:** 

![image](https://gitee.com/swang-harbin/pic-bed/raw/master/images/2021/20210607175540.png)

使用VLAN技术, 将交换机上的1, 2两个端口划分到一个vlan中, 将3, 4两个端口划分到另一个vlan中. 这时1口连接的PC机所发出的广播包, 只能被2口所连的PC机接收, 不能被3口, 4口所接收.

### 交换机上配置vlan命令

交换机全局模式下:

```
Switch(config)# vlan 10 // 创建vlan10: vlan vlan-id
Switch(config)# exit
Switch(config)# interface f0/1  // 进入F0/1物理端口
Switch(config)# switchport mode access  // 设置当前端口模式为access模式
Switch(config)# switchport access vlan 10   // 将端口F0/1划分到VLAN 10中
Switch(config)# show vlan // 显示vlan信息
Switch(config)#
Switch(config)#
Switch(config)#
Switch(config)#
```

示例:

使用四根网线(正线)依次连接交换机的F0/1, F0/2, F0/3, F0/4端口, 使用console线连接PC机的com口和交换机的console口, 此时, 使用该PC机通过超级终端登录到交换机即可设置VLAN. 

```
Switch> enable  // 进入特权模式
Switch# configure terminal  // 进入全局模式
Enter conofiguration commands, one per line. End with CNTL/Z.
Switch(config)# vlan 10 // 创建10号vlan
Switch(config-vlan)# exit   // 退出到全局模式
Switch(config)# vlan 20 // 创建20号vlan
Switch(config-vlan)# exit   // 退出到全局模式
Switch(config)# do show vlan    // 显示vlan的配置
VLAN    Name        Status      Ports
----    -------     ----------- ----------------
